<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">weave-zeus</span>
  <span class="s">&quot;a weaver to generate our next iteration&quot;</span>
  <span class="p">[</span><span class="nv">state</span> <span class="nv">code</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">keyword? </span><span class="p">(</span><span class="nb">first </span><span class="nv">code</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="ss">:magic-word</span> <span class="p">(</span><span class="nb">first </span><span class="nv">code</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">weave-zeus</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">state</span> 
                             <span class="ss">:current-file</span>, <span class="p">(</span><span class="nb">first </span><span class="p">(</span><span class="nb">rest </span><span class="nv">code</span><span class="p">)))</span> 
                      <span class="p">(</span><span class="nb">drop </span><span class="mi">2</span> <span class="nv">code</span><span class="p">))</span>
          <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">file-key</span> <span class="p">(</span><span class="nf">key-maker</span> <span class="p">(</span><span class="ss">:current-file</span> <span class="nv">state</span><span class="p">))]</span>
              <span class="p">(</span><span class="nf">weave-zeus</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">state</span>
                                 <span class="nv">file-key</span>, 
                                 <span class="p">(</span><span class="nb">apply str </span><span class="p">(</span><span class="nf">state</span> <span class="nv">file-key</span><span class="p">)</span> <span class="p">(</span><span class="nb">first </span><span class="p">(</span><span class="nb">rest </span><span class="p">(</span><span class="nb">rest </span><span class="nv">code</span><span class="p">)))))</span> 
                          <span class="p">(</span><span class="nb">drop </span><span class="mi">3</span> <span class="nv">code</span><span class="p">))))</span>                                                      
      <span class="nv">state</span><span class="p">))</span>
</pre></div>